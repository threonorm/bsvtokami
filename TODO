Add support for structs
Fix bug with missing guards
Test tuple?
